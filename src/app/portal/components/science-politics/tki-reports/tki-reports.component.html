<!-- # This file is part of the research.fi API service
#
# Copyright 2019 Ministry of Education and Culture, Finland
#
# :author: CSC - IT Center for Science Ltd., Espoo Finland servicedesk@csc.fi
# :license: MIT -->
<app-banner-divider></app-banner-divider>
<span *ngIf="modalOverlayVisible && value" class="modal-overlay" [ngStyle]="{ height: modalOverlayHeight + 'px' }"
      (click)="modalOverlayClick()"></span>
<main id="main-content">
  <div class="wrapper">
    <div class="row">
      <div class="wrapper">
        <div class="row pt-4">
          <div class="col text-center mt-3">
            <h1 i18n="@@externalLinksHeader">Selvityksiä ja raportteja</h1>
          </div>
        </div>
      </div>
      <br>
      <br>
    </div>
    <br>
    <br>
    <div class="row pt-4 tki-search-inputs-row d-flex flex-nowrap">
      <div class="search-input d-flex col-xs-6 col-md-12 ml-4 input search-field">
        <input matInput type="text" [(ngModel)]="value"
               class="col-10 col-sm-11 pr-0"
               #searchInput
               mat-input
               type="text"
               i18n-title="@@searchTooltipTki"
               title="Voit hakea selvityksiä ja raportteja Suomen tutkimus- ja innovaatiojärjestelmästä"
               i18n-placeholder="@@searchPlaceholderTki"
               placeholder="Hae raportti..."
               id="searchInput"
               autocomplete="off"
               tabindex="0"
               (focus)="onFocus()"
               (keyup)="onKeyup($event)"
               (keydown)="disableKeys($event)"
        />
      </div>
      <span
        class="reset-search"
        (click)="resetSearch()"
        (keyup.enter)="resetSearch()"
        tabindex="0"
        i18n-title="@@resetSearchTooltip"
        title="Tyhjennä haku"
      >
                  <i class="fa fa-times"></i>
                </span>
      <app-primary-action-button
        class="search-button"
        content="Hae"
        i18n-content="Search@@search"
        [icon]="faSearch"
        (click)="doFiltering(false)"
        (keyup.enter)="doFiltering(false)"
        type="submit"
      ></app-primary-action-button>
    </div>

    <!-- Search result modal -->
    <div *ngIf="modalOverlayVisible && value" class="row no-gutters d-flex col-12 col-md-12">
      <div class="tki-search-results-modal auto-suggest search-field-width">
        <h2 *ngIf="matchedNames.size > 0">Nimi</h2>
        <ul>
          <app-list-item *ngFor="let row of matchedNames; let index = index" class="list-group-item" [doc]="row[0]"
                         [id]="row[1]">
            <p (click)="modalSearchRowClick(row[1])">{{row[0]}}</p>
          </app-list-item>
        </ul>
        <hr *ngIf="matchedNames.size > 0">

        <h2 *ngIf="matchedAuthors.size > 0">Tekijät</h2>
        <ul>
          <app-list-item *ngFor="let row of matchedAuthors; let index = index" class="list-group-item" [doc]="row[0]"
                         [id]="row[1]">
            <p (click)="modalSearchRowClick(row[1])">{{row[0]}}</p>
          </app-list-item>
        </ul>
        <hr *ngIf="matchedAuthors.size > 0">

        <h2 *ngIf="matchedKeywords.size > 0">Asiasanat</h2>
        <ul>
          <app-list-item *ngFor="let row of matchedKeywords; let index = index" class="list-group-item" [doc]="row[0]"
                         [id]="row[1]">
            <p (click)="modalSearchRowClick(row[1])">{{row[0]}}</p>
          </app-list-item>
        </ul>
        <hr *ngIf="matchedKeywords.size > 0">

        <h2 *ngIf="matchedYears.size > 0">Vuosi</h2>
        <ul>
          <app-list-item *ngFor="let row of matchedYears; let index = index" class="list-group-item" [doc]="row[0]"
                         [id]="row[1]">
            <p (click)="modalSearchRowClick(row[1])">{{row[0]}}</p>
          </app-list-item>
        </ul>
        <p
          *ngIf="!matchedNames.size > 0 && !matchedAuthors.size > 0 && !matchedYears.size && !matchedKeywords.size > 0">
          Ei hakutuloksia</p>

        <br>
      </div>
    </div>
    <br>
    <br>

    <!-- List view for mobile only -->
    <div class="tki-search-results-mobile" [class.d-none]="!isMobile">
      <div *ngFor="let row of resultDataMobile">
        <h2>Nimi</h2>
        <a href="{{row.link}}" target="_blank"><p [innerHTML]="row.name"></p></a>
        <h2>Vuosi</h2>
        <p [innerHTML]="row.year | highlight: value"></p>
        <h2>Julkaisija</h2>
        <p [innerHTML]="row.authors | highlight: value"></p>
        <h2>Asiasanat</h2>
        <p [innerHTML]="row.keywords | highlight: value"></p>
        <hr>
      </div>
    </div>

    <!-- Table view for desktop only -->
    <div class="tki-search-results-desktop" [class.d-none]="isMobile">
      <mat-table [dataSource]="formattedTableData" matSort>
        <ng-container matColumnDef="name">
          <mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by number">Nimi
          </mat-header-cell>
          <mat-cell *matCellDef="let element"><a href="{{element.link}}" target="_blank">{{element.name}}</a></mat-cell>
        </ng-container>

        <ng-container matColumnDef="year">
          <mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by number">Vuosi
          </mat-header-cell>
          <mat-cell *matCellDef="let element">{{element.year}}</mat-cell>
        </ng-container>

        <ng-container matColumnDef="authors">
          <mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by number">Tekijät
          </mat-header-cell>
          <mat-cell *matCellDef="let element">{{element.authors}}</mat-cell>
        </ng-container>

        <ng-container matColumnDef="keywords">
          <mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by number">Asiasanat
          </mat-header-cell>
          <mat-cell *matCellDef="let element">{{element.keywords}}</mat-cell>
        </ng-container>

        <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
        <mat-row *matRowDef="let row; columns: displayedColumns"></mat-row>
      </mat-table>
    </div>
    <br>
    <br>
  </div>
</main>
