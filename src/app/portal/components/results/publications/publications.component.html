<!--  This file is part of the research.fi API service
 Copyright 2019 Ministry of Education and Culture, Finland
 :author: CSC - IT Center for Science Ltd., Espoo Finland servicedesk@csc.fi
 :license: MIT -->

<div class="spinner-center" *ngIf="!resultData">
  <mat-spinner [diameter]="80"></mat-spinner>
</div>
<!-- Data -->
<div *ngIf="resultData && resultData.total > 0; else noResults">
  <app-table
    *ngIf="dataMapped"
    [columns]="tableColumns"
    [rows]="tableRows"
    [icon]="faIcon"
    [iconTitle]="iconTitlePublications"
    iconLinkField="name"
    [sortColumn]="sortService.sortColumn"
    [sortDirection]="sortService.sortDirection ? 'desc' : 'asc'"
    (onSortChange)="utilityService.sortBy($event.active)"
  ></app-table>

  <!-- Templates -->
  <div *ngIf="resultData" class="result-container">
    <div *ngFor="let publication of resultData.publications; let i = index">
      <ng-template #publicationNameColumn>
        <div class="title">
          <a routerLink="/results/publication/{{ publication.id }}">
            <h4
              class="result-title"
              [attr.lang]="
                publication.languageCode !== documentLang
                  ? publication.languageCode
                  : null
              "
              [innerHtml]="publication.title | highlight: input"
            ></h4>
          </a>
          <div class="tags">
            <div
              *ngIf="isReviewed(publication.publicationTypeCode)"
              class="peer-reviewed"
              i18n="@@peerReviewed"
            >
              Vertaisarvioitu
            </div>
            <a
              *ngIf="publication.openAccess && (publication | links)"
              href="{{ publication | links }}"
              target="_blank"
              class="open-access div"
            >
              <span class="open-access-image"></span>
              <span i18n="@@openAccess">Avoin saatavuus</span
              ><fa-icon icon="external-link-alt"></fa-icon>
            </a>
            <!-- Span is for publications that doesn't have OA link. Angular doesn't allow void(0) to be passed without unsafe warnings -->
            <span
              *ngIf="publication.openAccess && !(publication | links)"
              class="open-access div"
            >
              <span class="open-access-image"></span>
              <span i18n="@@openAccess">Avoin saatavuus</span>
            </span>
            <div *ngIf="publication.doi?.trim()" class="doi">
              <span class="doi-tag">DOI</span>
              <span class="doi-link"
                ><a href="https://doi.org/{{ publication.doi }}" target="_blank"
                  >{{ publication.doi
                  }}<fa-icon icon="external-link-alt"></fa-icon></a
              ></span>
            </div>
          </div>
        </div>
      </ng-template>

      <ng-template #publicationChannelColumn>
        <span
          [attr.lang]="
            publication.languageCode !== documentLang
              ? publication.languageCode
              : null
          "
          [innerHtml]="
            publication.publicationChannel | cutContent: 100 | highlight: input
          "
        >
        </span>
      </ng-template>
    </div>
  </div>
  <!-- Pagination -->
  <app-results-pagination [data]="resultData"></app-results-pagination>
</div>

<ng-template #noResults>
  <app-no-results
    *ngIf="resultData && resultData.total === 0"
    heading="Ei julkaisuja"
    i18n-heading="@@noPublications"
  ></app-no-results>
</ng-template>
