<!--  This file is part of the research.fi API service
 Copyright 2019 Ministry of Education and Culture, Finland
 :author: CSC - IT Center for Science Ltd., Espoo Finland servicedesk@csc.fi
 :license: MIT -->

<table
  mat-table
  matSort
  (matSortChange)="sortData($event)"
  [dataSource]="data"
  [matSortActive]="sortColumn"
  [matSortDirection]="sortColumn ? sortDirection : ''"
  class="w-100 d-none d-lg-table"
  [@.disabled]="true"
>
  <ng-container *ngFor="let column of columns" [matColumnDef]="column.label">
    <th
      mat-header-cell
      *matHeaderCellDef
      [mat-sort-header]="column.key"
      [disabled]="column.key === 'icon'"
      class="border-0"
      [class.no-active-sort]="sortColumn.length === 0"
    >
      <span [class.invisible]="column.key === 'icon'">
        {{ column.label }}
      </span>
    </th>

    <td
      mat-cell
      *matCellDef="let data"
      [ngSwitch]="column.key"
      class="border-0"
      [class.col-1]="column.key === 'icon'"
      [ngClass]="column.columnSize ? 'col-' + column.columnSize : 'col-auto'"
    >
      <!-- Optional icon -->
      <ng-container *ngIf="column.key === 'icon' && iconLinkField">
        <a
          *ngIf="data[iconLinkField].link"
          tabindex="-1"
          [routerLink]="data[iconLinkField].link"
        >
          <ng-container *ngTemplateOutlet="iconTemplate"></ng-container>
        </a>
      </ng-container>
      <ng-template #iconTemplate>
        <fa-icon [icon]="data.icon" *ngSwitchCase="'icon'" class="pe-3">
        </fa-icon>
      </ng-template>

      <!-- Cell data  -->
      <h4 *ngSwitchDefault>
        <app-table-cell [data]="data[column.key]"></app-table-cell>
      </h4>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
</table>

<!-- Mobile list view -->
<div class="d-block d-lg-none">
  <div class="row py-3" *ngFor="let row of data">
    <ng-container *ngFor="let column of columns">
      <div
        [ngClass]="
          row[column.key].columnSize
            ? 'col-' + row[column.key].columnSize
            : 'col-auto'
        "
        *ngIf="column.key !== 'icon'"
      >
        <h4>
          <app-table-cell [data]="row[column.key]"></app-table-cell>
        </h4>
      </div>
    </ng-container>
  </div>
</div>
