<!--  This file is part of the research.fi API service
 Copyright 2019 Ministry of Education and Culture, Finland
 :author: CSC - IT Center for Science Ltd., Espoo Finland servicedesk@csc.fi
 :license: MIT -->

 <h2 class="row" style="float:left; margin-top:10px; margin-left: 43px;">Hakutulokset</h2>
 <div class="spinner-center" *ngIf="!publicationData">
     <mat-spinner [diameter]="80"></mat-spinner>
 </div>
 <div class="sort">
     <span class="align-left" style="margin-right: 25px; text-transform: uppercase;">Järjestä</span>
     <mat-form-field>
         <select matNativeControl>
            <option value="newest">Uusin ensin</option>
            <option value="oldet">Vanhin ensin</option>
         </select>
     </mat-form-field>
 </div>
 <div *ngFor="let publications of publicationData">
    <div class="row no-margin">
        <div class="col arrow">
        </div>
        <div class="col">
            <span class="bold uppercase">Julkaisun nimi</span>
        </div>
        <div class="col">
            <span class="bold uppercase">Tekijät</span>
        </div>
        <div class="col col-md-2">
            <span class="bold uppercase">Julkaisukanava</span>
        </div>
        <div class="col col-md-1">
            <span class="bold uppercase">Vuosi</span>
        </div>
    </div>
    <div *ngIf="paginationCheck; else nextTemplate">
        <div *ngFor="let publications of publicationData;">
            <div class="row no-margin single" *ngFor="let x of publications.hits.hits; let i = index"
            (click)="expandStatus[i]=!expandStatus[i]" [class.expand]="expandStatus[i]">
                <div class="col arrow">
                    <a class="arrow" [attr.data-selected]="false" [class.expand]="expandStatus[i]"></a>
                </div>          
                <div class="col">
                    <a routerLink="/single/{{x._source.doc.row.publicationId}}"><h3 style="font-size: 1rem">{{x._source.doc.row.publicationName}}</h3></a>
                </div>          
                <div class="col shorten" [class.expand]="expandStatus[i]">
                    <span>{{x._source.doc.row.authorsText}}</span>
                </div>          
                <div class="col col-2 shorten" [class.expand]="expandStatus[i]">
                    <span>{{x._source.doc.row.journalName}}</span>
                </div>          
                <div class="col col-1">
                    <span>{{x._source.doc.row.publicationYear}}</span>
                    <input type="hidden" value="{{x._source.doc.row.publicationId}}" #singleId>
                </div>
            </div>       
        </div>
    </div>
    <ng-template #nextTemplate>
        <div class="row no-margin single" *ngFor="let publication of publications.aggregations?._index.buckets.julkaisut.index_results.hits.hits; let i = index"
        (click)="expandStatus[i]=!expandStatus[i]" [class.expand]="expandStatus[i]">
            <div class="col arrow">
                <a class="arrow" [attr.data-selected]="false" [class.expand]="expandStatus[i]"></a>
            </div>          
            <div class="col">
                <a routerLink="/single/{{publication?._source.doc.row.publicationId}}"><h3 style="font-size: 1rem">{{publication?._source.doc.row.publicationName}}</h3></a>
            </div>          
            <div class="col shorten" [class.expand]="expandStatus[i]">
                <span>{{publication._source.doc.row.authorsText}}</span>
            </div>          
            <div class="col col-2 shorten" [class.expand]="expandStatus[i]">
                <span>{{publication._source.doc.row.journalName}}</span>
            </div>          
            <div class="col col-1">
                <span>{{publication._source.doc.row.publicationYear}}</span>
                <input type="hidden" value="{{publication?._source.doc.row.publicationId}}" #singleId>
            </div>          
        </div>
    </ng-template>
    <!-- Pagination, check if request is GET or POST and do the math -->
    <a [ngClass]="fromPage > 1 ? 'pagination-link': 'disabled'" (click)="previousPage()">Edellinen sivu</a><a> | </a>
    <a *ngIf="paginationCheck" [ngClass]="fromPage + 10 < publications.hits.total ? 'pagination-link': 'disabled'" (click)="nextPage()">Seuraava sivu</a>
    <a *ngIf="!paginationCheck" [ngClass]="fromPage + 10 < publications.aggregations?._index.buckets.julkaisut.doc_count ? 'pagination-link': 'disabled'" (click)="nextPage()">Seuraava sivu</a>
    <div class="result-count">
        <p *ngIf="fromPage + 10 < publications.aggregations?._index.buckets.julkaisut.doc_count && !paginationCheck">Näytetään tulokset {{fromPage + 1}} - {{fromPage + 10}} / {{publications.aggregations?._index.buckets.julkaisut.doc_count}}</p>
        <p *ngIf="fromPage + 10 >= publications.aggregations?._index.buckets.julkaisut.doc_count && !paginationCheck">Näytetään tulokset {{fromPage + 1}} - {{publications.aggregations?._index.buckets.julkaisut.doc_count}} / {{publications.aggregations?._index.buckets.julkaisut.doc_count}}</p>          
        <p *ngIf="fromPage + 10 < publications.hits.total && paginationCheck">Näytetään tulokset {{fromPage + 1}} - {{fromPage + 10}} / {{publications.hits.total}}</p>
        <p *ngIf="fromPage + 10 >= publications.hits.total && paginationCheck">Näytetään tulokset {{fromPage + 1}} - {{publications.hits.total}} / {{publications.hits.total}}</p>          
    </div>
</div>   
