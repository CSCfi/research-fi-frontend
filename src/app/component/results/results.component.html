<!--  This file is part of the research.fi API service
Copyright 2019 Ministry of Education and Culture, Finland
:author: CSC - IT Center for Science Ltd., Espoo Finland servicedesk@csc.fi
:license: MIT -->

<h1 #srHeader aria-live="polite" class="sr-only"></h1>
<aside>
    <app-search-bar></app-search-bar>
</aside>

<!-- <div class="text-center" *ngIf="!tabValues || !filterValues">
    <mat-spinner [diameter]="40"></mat-spinner>
</div> -->

<div class="center-content wrapper" style="margin-top: 0">
    <div class="row">
        <app-result-tab style="width:100%" [allData]="tabValues"></app-result-tab>
        <div class="col-12 px-0">
        <div class="row total" #totalHeader>
            <div class="col">
                <h2 role="status" class="total" *ngIf="selectedTabData ? selectedTabData.labelFi : ''">
                    {{selectedTabData.labelFi}} - <span class="total">{{parsedTotal}}</span>
                    <span class="sr-only">hakutulosta</span>
                </h2>
                <div id="sr-helper" class="row skip-links pb-2" [ngClass]="showSkipLinks ? 'show' : 'sr-only'">
                    <a (focus)="showSkipLinks = true" #skipToResults tabindex="0" (click)="changeFocusTarget('main')" 
                    (keydown.enter)="changeFocusTarget('main')" (blur)="resetFocus(); showSkipLinks = false" href="javascript:void(0)">
                        Hyppää hakutuloksiin
                    </a>
                </div>
            </div>
            <div class="col-auto text-right align-self-center">
                <a routerLink="/service-info" fragment="1"><strong>Mitä {{selectedTabData?.singularFi}}tietoja palvelu sisältää?</strong></a>
            </div>
        </div>
        </div>
    </div>
    <div *ngIf="page <= 1000; else pageOverflow">
        <div class="row">
            <div *ngIf="mobile; else desktop" class="col-12 row" style="padding:0;">
                <aside class="col col-6 col-sm-6 filters">
                    <app-filters *ngIf="tab===tabData[0].link" [responseData]="filterValues" [tabData]="tabData[0].data"></app-filters>
                    <app-filters *ngIf="tab===tabData[1].link" [responseData]="filterValues" [tabData]="tabData[1].data"></app-filters>
                    <app-filters *ngIf="tab===tabData[2].link" [responseData]="filterValues" [tabData]="tabData[2].data"></app-filters>
                    <app-filters *ngIf="tab===tabData[4].link" [responseData]="filterValues" [tabData]="tabData[4].data"></app-filters>
                    <app-filters *ngIf="tab===tabData[6].link" [responseData]="filterValues" [tabData]="tabData[6].data"></app-filters>
                </aside>
                <aside class="col col-6 col-sm-6 sort">
                    <app-sort></app-sort>
                </aside>
                <main class="col-12" id="main-content">
                    <app-active-filters></app-active-filters>
                    <!-- <h2 style="padding: 24px 10px;">Hakutulokset <span class="total">({{total}})</span></h2> -->
                    <app-search-results [currentTab]="selectedTabData" [updateFilters]="updateFilters"></app-search-results>
                </main>
            </div>
        </div>
    </div>
</div>

<ng-template #desktop>
    <aside class="col-4 col-xl-3 filters">
        <app-filters *ngIf="tab===tabData[0].link"  [responseData]="filterValues" [tabData]="tabData[0].data"></app-filters>
        <app-filters *ngIf="tab===tabData[1].link"  [responseData]="filterValues" [tabData]="tabData[1].data"></app-filters>
        <app-filters *ngIf="tab===tabData[2].link"  [responseData]="filterValues" [tabData]="tabData[2].data"></app-filters>
        <app-filters *ngIf="tab===tabData[4].link"  [responseData]="filterValues" [tabData]="tabData[4].data"></app-filters>
        <app-filters *ngIf="tab===tabData[6].link"  [responseData]="filterValues" [tabData]="tabData[6].data"></app-filters>
    </aside>
    <div class="col-8 col-xl-9 row main-content pr-xl-0">
        <main class="col-12 pr-xl-0">
            <app-active-filters></app-active-filters>
            <app-search-results id="main-content" [currentTab]="selectedTabData" [updateFilters]="updateFilters"></app-search-results>
        </main>
    </div>
</ng-template>

<ng-template #pageOverflow>
    <div class="row main-content">
        <div class="col text-center no-results">
            <h2>Tuloksia näytetään enintään 10 000</h2>
            <p>Jos hakemaasi tulosta ei löytynyt, yritä tarkentaa hakua.</p>
        </div>
    </div>
</ng-template>