<!--  This file is part of the research.fi API service
 Copyright 2019 Minisdivy of Education and Culture, Finland
 :author: CSC - IT Center for Science Ldiv., Espoo Finland servicedesk@csc.fi
 :license: MIT -->

 <h1 #srHeader class="sr-only"></h1>
 <aside>
     <app-search-bar></app-search-bar>
 </aside>
 
 <div class="container" *ngIf="responseData" id="main-content">
     <!-- Breadcrumb -->
     <app-breadcrumb [type]="'single'" [responseData]="[responseData]" [tab]="tab" [tabName]="'hankkeet'" [resultNameField]="'nameFi'"></app-breadcrumb>
     <div class="row shared">
        <p class="back col-12"><a routerLink="/results/{{tab}}/{{searchTerm}}" [queryParams]="{'page': pageNumber}">&lt; Takaisin hakutuloksiin</a></p>
         <div class="col-12" style="margin: 10px 0 10px 0;" *ngIf="responseData.total === 0">
             <h2>404 - Virheellinen osoite</h2>
         </div>
         <main class="col-12 col-md-8">
             <div *ngFor="let item of responseData.fundings">
                 <h1 class="result-header">{{item.nameFi}}</h1>
                 <div id="info" class="table">
                    <div class="content">
                        <ng-container *ngFor="let row of infoFields">
                            <div class="row" *ngIf="item[row.field]">
                                <div class="col-6 col-lg-3 th">{{row.label}}</div>
                                <div class="col-6 col-lg-9 td">
                                    <div [ngClass]="expand ? 'expand' : 'short'">{{item[row.field]}}</div>
                                    <a href="javascript:void(0)" class="read-more" *ngIf="row.field === 'descriptionFi' && item.descriptionFi?.length > 256" (click)="expandDescription()" 
                                        [innerHTML]="expand ? 'Näytä vähemmän' : 'Lue lisää'"></a>
                                </div>
                            </div>
                        </ng-container>
                        <!-- Consortium info -->
                        <div *ngIf="item.recipientType==='consortium'" class="row">
                            <div class="col-6 col-lg-3 th">Suomen akatemian konsortio</div>
                            <div class="col-6 col-lg-9 td">
                                <div [ngClass]="expand ? 'expand' : 'short'">{{item.academyConsortium}}</div>
                            </div>
                            <div class="col-6 col-lg-3 th">Konsortion muut osapuolet</div>
                            <div class="col-6 col-lg-9 td">
                                <div [ngClass]="expand ? 'expand' : 'short'">
                                        <ng-container *ngFor="let consortium of item.otherConsortium; let i = index">
                                            {{consortium.consortiumOrganizationNameFi}} ({{consortium.consortiumProject}})<ng-container *ngIf="i !== item.otherConsortium.length - 1">, </ng-container>
                                        </ng-container>
                                        
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Funded -->
                    <div class="content">
                        <p class="header trHeader">Rahoituksen saaja</p>
                        <!-- Person -->
                        <div class="row" *ngIf="!(item.recipientType === 'organization') && item.recipient.personName.length > 0">
                            <div class="col-3 th">
                                <div>Nimi</div>
                            </div>
                            <div class="col-5 td">
                                {{item.recipient.personName}}
                                <app-orcid *ngIf="item.recipient.personOrcid" [orcid]="item.recipient.personOrcid"></app-orcid>
                            </div>
                            <div class="col-4 td">
                                <!-- <div>{{item.recipient.affiliation}}</div> -->
                                <div>{{item.recipient.shareOfFundingEur | thousandSeparator}} €</div>
                            </div>
                        </div>
                        <div class="row" *ngIf="!(item.recipientType === 'organization') && item.recipient.affiliation?.trim().length > 0">
                            <div class="col-3 th">
                                <div>Organisaatio</div>
                            </div>
                            <div class="col-5 td">
                                {{item.recipient.affiliation}}
                            </div>
                            <div class="col-4 td">
                                <!-- <div>{{item.recipient.affiliation}}</div> -->
                                <div>{{item.recipient.shareOfFundingEur | thousandSeparator}} €</div>
                            </div>
                        </div>
                        <!-- Org -->
                        <div *ngIf="item.recipientType === 'organization'" class="row">
                            <div class="col-3 th">
                                <div>Organisaatio</div>
                            </div>
                            <ng-container *ngFor="let org of item.recipient.organizations; let i = index;">
                                <div class="col-5 td" [class.offset-3]="i>0">{{org.nameFi}}</div>
                                <div class="col-4 td">{{org.shareOfFundingEur | thousandSeparator}} €</div>
                                <ng-container *ngIf="item.recipient.contactPersonName.trim().length > 0">
                                    <div class="col-3 th">
                                        <span>Yhteyshenkilö</span>
                                    </div>
                                    <div class="col-4 col-lg-5 td">
                                        {{item.recipient.contactPersonName}}
                                        <app-orcid *ngIf="item.recipient.personOrcid" [orcid]="item.recipient.personOrcid"></app-orcid>
                                    </div>
                                </ng-container>
                            </ng-container>
                        </div>
                        <div class="row">
                            <div class="col-3 th">Myönnetty summa</div>
                            <!-- <div class="col-3 td" [class.offset-5]="item.recipientType === 'organization'"> -->
                            <div class="col-3 td offset-5">
                                <div [class.bold]="item.recipientType==='organization'">{{item.recipient.amountEur | thousandSeparator}} €</div>
                            </div>
                        </div>
                    </div>
                    <!-- Funder -->
                    <div class="content" *ngIf="item.funder && funderFields.length > 0">
                        <p class="header trHeader">Rahoittaja</p>
                        <div class="row" *ngFor="let row of funderFields">
                            <div class="col-6 col-lg-3 th">{{row.label}}</div>
                            <div class="col-6 col-lg-9 td">{{item.funder[row.field]}}</div>
                        </div>
                    </div>
                    <!-- Other -->
                    <div class="content" *ngIf="otherFields.length > 0">
                        <p class="header trHeader">Muut tiedot</p>
                        <div class="row" *ngFor="let row of otherFields">
                            <div class="col-6 col-lg-3 th">{{row.label}}</div>
                            <div class="col-6 col-lg-9 td">{{item[row.field]}}</div>
                        </div>
                    </div>
                </div>
             </div>
         </main>
         <div *ngFor="let item of responseData.fundings" class="col-12 col-md-4 col-xl-4">
            <aside>
                <aside>
                    <mat-card>
                        <mat-card-title><h2>Hankkeen verkkosivu</h2></mat-card-title>
                        <div class="row links">
                            <div *ngFor="let row of linkFields" class="info-link-wrapper">
                                <div class="col-sm-2 col-md-1 icon">
                                    <fa-icon [icon]="faIcon"></fa-icon>
                                </div>
                                <div class="col link">
                                    <a class="info-link" href="{{item[row.field]}}" target="_blank">{{item[row.field]}} <fa-icon icon="external-link-alt"></fa-icon></a>
                                </div>
                            </div>
                        </div>
                        <div *ngIf="!linkFields.length" class="no-links">Hankkeeseen ei ole tarjolla linkkejä tässä portaalissa</div>
                    </mat-card>
                </aside>
                <mat-card>
                    <mat-card-title><h2>Tähän hankkeeseen liittyvät</h2></mat-card-title>
                    <div class="row related">
                        <ul class="col-12 col-sm-6 col-md-12 col-xl-6">
                            <li class=""><a routerLink="/">Julkaisut</a></li>
                            <li class=""><a routerLink="/">Tutkijat</a></li>
                            <li class=""><a routerLink="/">Aineistot</a></li>
                        </ul>
                        <ul class="col-12 col-sm-6 col-md-12 col-xl-6">
                            <li class=""><a routerLink="/">Infrastruktuurit</a></li>
                            <li class=""><a routerLink="/">Organisaatiot</a></li>
                        </ul>
                    </div>
                </mat-card>
            </aside>
            <!-- <aside>
                <mat-card>
                    <mat-card-title><h2>Viittaa</h2></mat-card-title>
                    <div class="row">
                        <div class="col-12 reference">
                            <button mat-raised-button color="primary"><fa-icon [icon]="faQuoteRight" class="quote"></fa-icon>Kopioi viitetiedot...</button>
                        </div>
                    </div>
                </mat-card>
            </aside> -->
            <!-- Social icons -->
            <app-share></app-share>
            <aside>
                <mat-card>
                    <mat-card-title><h2>Hanketiedon lähde</h2></mat-card-title>
                    <div *ngFor="let source of responseData.fundings">
                        <p *ngIf="source.funder.nameFi.trim().length > 0">Rahoittaja: {{source.funderNameFi}}</p>
                        <p *ngIf="source.funder.nameFi.trim().length === 0">Tiedon lähde ei saatavilla.</p>
                    </div>
                    <div class="clear"></div>
                </mat-card>
            </aside>
        </div>
     </div>
 </div>