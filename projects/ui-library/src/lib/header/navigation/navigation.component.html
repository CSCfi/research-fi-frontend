<nav class="">
  <div class="mobile ml-auto toggle-button-wrapper">
    <button
      *ngIf="!navbarOpen"
      class="navbar-toggler navbar-toggler-right menu"
      type="button"
      (click)="toggleNavbar()"
      #navbarToggler
    >
      <div class="toggle-menu-text closed" i18n="@@headerMenuOpen">Valikko</div>
    </button>
    <lib-close-button
      *ngIf="navbarOpen"
      (click)="toggleNavbar()"
    ></lib-close-button>
  </div>
  <div
    class=""
    [class.overflow-hider]="hideOverflow && mobile"
    [class.absolute]="mobile"
    [ngClass]="mobile ? (hideOverflow ? 'invisible' : 'visible') : ''"
    #overflowHider
  >
    <div
      class="collapse navbar-collapse menu row"
      [class.mobile-bar]="mobile"
      [class.open]="navbarOpen && mobile"
      #mainNavbar
    >
      <!-- Lang selector -->
      <div class="navbar-expand mx-auto navbar-nav lang mobile">
        <ul class="navbar-nav mx-auto">
          <li *ngFor="let domain of localizedDomains" [class.col-4]="mobile">
            <a
              class="nav-item nav-link lang-box"
              [class.active-lang]="currentLang === domain.locale"
              [href]="domain.url + currentRoute"
            >
              <span class="label">{{ domain.label }}</span>
            </a>
          </li>
        </ul>
      </div>
      <!-- Nav items -->
      <div class="col p-0">
        <ul class="nav-right navbar-nav main" [class.row]="!mobile">
          <ng-container *ngFor="let item of navItems">
            <li
              *ngIf="!item.dropdownItems; else dropdownLink"
              class="nav-item col col-auto p-0"
            >
              <a
                class="nav-item nav-link"
                [routerLink]="
                  item.link.trim().length > 0 ? item.link : currentRoute
                "
                routerLinkActive="active-link"
                [routerLinkActiveOptions]="{ exact: item.exact }"
                (click)="handleLinkClick(item)"
              >
                <span class="label">{{ item.label }}</span>
              </a>
            </li>
            <ng-template #dropdownLink>
              <li
                class="nav-item col col-auto p-0 parent"
                (click)="dropdownOpen = !dropdownOpen"
                (clickOutside)="onClickedOutside($event)"
              >
                <a
                  class="nav-item nav-link parent-link disabled-link"
                  tabindex="0"
                  [routerLink]="item.link"
                  routerLinkActive="active-link"
                  (keydown.enter)="$event.preventDefault(); dropdownOpen = true"
                  (keydown.space)="$event.preventDefault(); dropdownOpen = true"
                  [class.open]="dropdownOpen"
                  [class.font-weight-bold]="dropdownOpen"
                >
                  <span class="label">{{ item.label }}</span>
                </a>
                <ul class="dropdown" *ngIf="dropdownOpen">
                  <li *ngFor="let subItem of item.dropdownItems">
                    <a
                      [routerLink]="subItem.link"
                      routerLinkActive="active-link"
                      (click)="navbarOpen && toggleNavbar()"
                      >{{ subItem.label }}
                    </a>
                  </li>
                </ul>
              </li>
            </ng-template>
          </ng-container>
          <!-- Lang selector -->
          <li #navLink class="nav-item col col-auto p-0 mr-0">
            <div class="navbar-expand navbar-nav lang langSelect">
              <mat-form-field class="lang-select">
                <!-- Navigate with consent if consent is set -->
                <mat-select [(value)]="lang">
                  <a
                    *ngFor="let domain of localizedDomains"
                    [href]="
                      domain.url +
                      currentRoute +
                      (consent ? '?consent=' + consent : '')
                    "
                  >
                    <mat-option [value]="domain.locale.toUpperCase()">{{
                      domain.locale.toUpperCase()
                    }}</mat-option>
                  </a>
                </mat-select>
              </mat-form-field>
            </div>
          </li>
          <div *ngIf="mobile" class=""></div>
        </ul>
      </div>
    </div>
  </div>
</nav>
<div *ngIf="navbarOpen" id="overlay" (click)="toggleNavbar()" #overlay></div>
